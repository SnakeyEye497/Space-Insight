{"cells":[{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true,"base_uri":"https://localhost:8080/","height":399},"id":"Wm-f7tQ95y_4"},"outputs":[{"name":"stdout","output_type":"stream","text":["==================================================\n","Your app is live at: NgrokTunnel: \"https://818a-34-23-17-209.ngrok-free.app\" -\u003e \"http://localhost:5000\"\n","==================================================\n"," * Serving Flask app '__main__'\n"," * Debug mode: off\n"]},{"name":"stderr","output_type":"stream","text":["INFO:werkzeug:\u001b[31m\u001b[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.\u001b[0m\n"," * Running on all addresses (0.0.0.0)\n"," * Running on http://127.0.0.1:5000\n"," * Running on http://172.28.0.12:5000\n","INFO:werkzeug:\u001b[33mPress CTRL+C to quit\u001b[0m\n","INFO:werkzeug:127.0.0.1 - - [14/Apr/2025 11:59:56] \"GET / HTTP/1.1\" 200 -\n","INFO:werkzeug:127.0.0.1 - - [14/Apr/2025 11:59:57] \"\u001b[33mGET /favicon.ico HTTP/1.1\u001b[0m\" 404 -\n"]},{"name":"stdout","output_type":"stream","text":["\u001b[1m1/1\u001b[0m \u001b[32m━━━━━━━━━━━━━━━━━━━━\u001b[0m\u001b[37m\u001b[0m \u001b[1m3s\u001b[0m 3s/step\n"]},{"name":"stderr","output_type":"stream","text":["INFO:werkzeug:127.0.0.1 - - [14/Apr/2025 12:02:32] \"POST / HTTP/1.1\" 200 -\n"]},{"name":"stdout","output_type":"stream","text":["Prediction Raw Output: [4.2390955e-05 3.2664353e-05 3.3458520e-05 9.9924624e-01 8.3688274e-06\n"," 1.2595591e-06 6.1163836e-04 2.3902676e-05]\n","Predicted Index: 3\n","Predicted Class: NGC3256_nuc1\n","Confidence Score: 99.92462396621704\n"]},{"name":"stderr","output_type":"stream","text":["INFO:werkzeug:127.0.0.1 - - [14/Apr/2025 12:02:32] \"GET /static/uploads/jw01995-o014_aug_10_NGC_188.jpg HTTP/1.1\" 200 -\n","INFO:werkzeug:127.0.0.1 - - [14/Apr/2025 12:02:49] \"POST /learn_more HTTP/1.1\" 200 -\n"]}],"source":["# Step 1: Imports\n","import os\n","import numpy as np\n","import shutil\n","from flask import Flask, render_template, request, flash\n","from tensorflow.keras.models import load_model\n","from tensorflow.keras.preprocessing import image\n","from PIL import Image\n","from pyngrok import ngrok\n","import logging\n","import google.generativeai as genai\n","# Step 2: Setup logging\n","logging.basicConfig(level=logging.INFO)\n","logger = logging.getLogger(__name__)\n","\n","# Step 3: Set paths (fixed spacing in paths)\n","drive_index_html_path = '/content/drive/MyDrive/Ml-project/Project-Review-3 /Codes.Run/Flask/index.html'\n","local_template_path = 'templates/index.html'\n","\n","# Step 4: Create necessary folders\n","os.makedirs(\"templates\", exist_ok=True)\n","os.makedirs(\"static/uploads\", exist_ok=True)\n","\n","# Step 5: Copy template file\n","try:\n","    shutil.copy(drive_index_html_path, local_template_path)\n","    logger.info(f\"Successfully copied template from {drive_index_html_path}\")\n","except Exception as e:\n","    logger.error(f\"Error copying template: {str(e)}\")\n","\n","# Step 5b: Copy learn_more.html from Google Drive\n","drive_learn_more_html_path = '/content/drive/MyDrive/Ml-project/Project-Review-3 /Codes.Run/Flask/learn.html'\n","local_learn_more_template_path = 'templates/learn_more.html'\n","\n","try:\n","    shutil.copy(drive_learn_more_html_path, local_learn_more_template_path)\n","    logger.info(f\"Successfully copied learn_more.html from {drive_learn_more_html_path}\")\n","except Exception as e:\n","    logger.error(f\"Error copying learn_more.html: {str(e)}\")\n","\n","# Step 6: Initialize Flask app\n","app = Flask(__name__)\n","app.config['UPLOAD_FOLDER'] = 'static/uploads/'\n","app.config['MAX_CONTENT_LENGTH'] = 16 * 1024 * 1024  # 16MB max upload\n","app.secret_key = 'galaxy_classification_secret_key'  # For flash messages\n","\n","# Step 7: Define model configurations\n","MODEL_CONFIGS = {\n","    'inceptionv3': {\n","        'path': '/content/drive/MyDrive/Ml-project/Project-Review-3 /Models/InceptionV3/inceptionv3_model.keras',\n","        'size': (299, 299)\n","    },\n","    'resnet50': {\n","        'path': '/content/drive/MyDrive/Ml-project/Project-Review-3 /Models/ResNet-50/top_mod.keras',\n","        'size': (224, 224)\n","    },\n","    'vgg16': {\n","        'path': '/content/drive/MyDrive/Ml-project/Project-Review-3 /Models/VGG16/vgg16_model.keras',\n","        'size': (224, 224)\n","    },\n","    'efficientnetb0': {\n","        'path': '/content/drive/MyDrive/Ml-project/Project-Review-3 /Models/EfficientNet-B0/Best_efficientnet_model.keras',\n","        'size': (224, 224)\n","    },\n","}\n","\n","# Step 8: Class labels (common for all models)\n","class_names = ['IC-5332', 'NGC188', 'NGC-4499', 'NGC3256_nuc1', 'NGC_1433', 'NGC_1365', 'M-74', 'NGC_628']\n","\n","# Step 9: Image preprocessing\n","def preprocess_image(img_path, target_size):\n","    try:\n","        img = Image.open(img_path).convert('RGB')\n","        img = img.resize(target_size)\n","        img_array = image.img_to_array(img)\n","        img_array = np.expand_dims(img_array, axis=0)\n","        img_array = img_array / 255.0\n","        return img_array\n","    except Exception as e:\n","        logger.error(f\"Error preprocessing image: {str(e)}\")\n","        return None\n","\n","\n","# Configure Gemini API\n","genai.configure(api_key=\"AIzaSyBqmgJXIumFGwJ5fpXMUT7mZtEah-97VU4\")\n","\n","@app.route('/learn_more', methods=['POST'])\n","def learn_more():\n","    galaxy_name = request.form['galaxy_name']\n","\n","    # Use Gemini to get detailed analysis\n","    model = genai.GenerativeModel('gemini-2.0-flash')\n","    prompt = f\"Give me a detailed scientific explanation of the galaxy '{galaxy_name}', including structure, type, and interesting facts.\"\n","\n","    try:\n","        response = model.generate_content(prompt)\n","        analysis = response.text\n","    except Exception as e:\n","        analysis = f\"Error fetching details: {e}\"\n","\n","    return render_template('learn_more.html', galaxy_name=galaxy_name, analysis=analysis)\n","\n","# Step 10: Home route with prediction\n","@app.route('/', methods=['GET', 'POST'])\n","def index():\n","    prediction = None\n","    predicted_class = None\n","    filename = None\n","    selected_model = None\n","    confidence = None\n","\n","    if request.method == 'POST':\n","        # Check if image is provided\n","        if 'image' not in request.files:\n","            flash('No image part in the request', 'error')\n","            return render_template('index.html',\n","                                  model_names=list(MODEL_CONFIGS.keys()))\n","\n","        file = request.files['image']\n","        selected_model = request.form.get('model', 'inceptionv3')  # Default to inceptionv3\n","\n","        # Validate file\n","        if file.filename == '':\n","            flash('No image selected', 'error')\n","            return render_template('index.html',\n","                                  model_names=list(MODEL_CONFIGS.keys()),\n","                                  selected_model=selected_model)\n","\n","        # Validate model\n","        if selected_model not in MODEL_CONFIGS:\n","            flash(f'Invalid model selected: {selected_model}', 'error')\n","            return render_template('index.html',\n","                                  model_names=list(MODEL_CONFIGS.keys()))\n","\n","        try:\n","            # Save file\n","            filename = file.filename\n","            filepath = os.path.join(app.config['UPLOAD_FOLDER'], filename)\n","            file.save(filepath)\n","            logger.info(f\"Image saved to {filepath}\")\n","\n","            # Get model configuration\n","            model_config = MODEL_CONFIGS[selected_model]\n","            model_path = model_config['path']\n","            target_size = model_config['size']\n","\n","            # Load selected model\n","            model = load_model(model_path)\n","            logger.info(f\"Loaded model: {selected_model}\")\n","\n","            # Predict\n","            img_array = preprocess_image(filepath, target_size)\n","            if img_array is not None:\n","                prediction = model.predict(img_array)[0]\n","                predicted_idx = np.argmax(prediction)\n","                predicted_class = class_names[predicted_idx]\n","                confidence = float(prediction[predicted_idx]) * 100\n","                logger.info(f\"Prediction: {predicted_class} with confidence {confidence:.2f}%\")\n","                print(\"Prediction Raw Output:\", prediction)\n","                print(\"Predicted Index:\", predicted_idx)\n","                print(\"Predicted Class:\", predicted_class)\n","                print(\"Confidence Score:\", confidence)\n","            else:\n","                flash('Error processing the image', 'error')\n","\n","        except Exception as e:\n","            logger.error(f\"Error during prediction: {str(e)}\")\n","            flash(f'Error: {str(e)}', 'error')\n","\n","    return render_template('index.html',\n","                          prediction=prediction,\n","                          predicted_class=predicted_class,\n","                          confidence=confidence,\n","                          filename=filename,\n","                          model_names=list(MODEL_CONFIGS.keys()),\n","                          selected_model=selected_model)\n","\n","# Step 11: Start Flask app with ngrok for Colab\n","def start_ngrok():\n","    # Instructions for setting up ngrok token:\n","    # 1. Sign up at ngrok.com\n","    # 2. Get your auth token from the ngrok dashboard\n","    # 3. Set it securely using the method below\n","\n","    # IMPORTANT: Don't hardcode your token in the script\n","    # Use environment variables or input it securely\n","    ngrok_token = os.environ.get(\"NGROK_AUTH_TOKEN\")\n","\n","    if not ngrok_token:\n","        # If not set in environment, prompt user\n","        ngrok_token = input(\"Enter your ngrok auth token: \")\n","\n","    try:\n","        ngrok.set_auth_token(ngrok_token)\n","        public_url = ngrok.connect(5000)\n","        logger.info(f\"Ngrok tunnel established at: {public_url}\")\n","        return public_url\n","    except Exception as e:\n","        logger.error(f\"Error setting up ngrok: {str(e)}\")\n","        return None\n","\n","if __name__ == \"__main__\":\n","    # Step 11a: Start ngrok tunnel\n","    public_url = start_ngrok()\n","    if public_url:\n","        print(\"=\"*50)\n","        print(f\"Your app is live at: {public_url}\")\n","        print(\"=\"*50)\n","\n","    # Step 11b: Run Flask app\n","    app.run(host='0.0.0.0', port=5000)"]},{"cell_type":"code","execution_count":1,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":24296,"status":"ok","timestamp":1744631918715,"user":{"displayName":"Swaraj Pawar","userId":"00736123951744289084"},"user_tz":-330},"id":"AhQzKgYL51ni","outputId":"aa245ee4-f378-4339-920b-b2fd7b081d41"},"outputs":[{"name":"stdout","output_type":"stream","text":["Mounted at /content/drive\n"]}],"source":["from google.colab import drive\n","drive.mount('/content/drive')"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":818},"executionInfo":{"elapsed":10756,"status":"ok","timestamp":1743931806556,"user":{"displayName":"Swaraj Pawar","userId":"00736123951744289084"},"user_tz":-330},"id":"uHCLS7iFC4Mz","outputId":"4ca97773-3c05-4c33-99f3-b1e35618667c"},"outputs":[{"name":"stdout","output_type":"stream","text":["Let's delve into a detailed scientific description of the galaxy IC 5322, a fascinating spiral galaxy in the southern constellation Tucana.\n","\n","**Basic Information \u0026 Classification:**\n","\n","*   **Designation:** IC 5322 (Index Catalogue 5322)\n","*   **Type:** Barred Spiral Galaxy (SBc)\n","\n","    *   **Barred Spiral (SB):** This classification signifies that the galaxy possesses a prominent bar-shaped structure crossing its galactic center. Spiral arms emanate from the ends of this bar. The presence of a bar is thought to influence the dynamics of the galaxy, funneling gas and dust towards the center, which can fuel star formation and possibly even feed a central supermassive black hole.\n","    *   **Type 'c':** The suffix 'c' indicates that the spiral arms are loosely wound, clumpy, and not as well-defined as in galaxies of type 'a' or 'b'.  Galaxies of type 'c' typically have a smaller central bulge compared to their overall size and a relatively high rate of star formation within the arms.\n","\n","*   **Constellation:** Tucana (The Toucan) - A southern constellation known for hosting part of the Small Magellanic Cloud.\n","*   **Distance:** The distance to IC 5322 is estimated to be around **75 million light-years** from Earth. This distance is based on redshift measurements, a phenomenon where light from receding objects is stretched towards the red end of the spectrum. Redshift is related to distance by Hubble's Law.\n","\n","**Structure and Morphology:**\n","\n","*   **Bar:** IC 5322 has a fairly prominent stellar bar crossing its central region. This bar consists of a dense concentration of stars and gas. The bar's dynamics play a crucial role in the galaxy's evolution, as gravitational torques within the bar redistribute angular momentum, causing gas to lose energy and spiral inward.\n","*   **Spiral Arms:** The spiral arms emanating from the ends of the bar are loosely wound and characterized by numerous HII regions (regions of ionized hydrogen). These HII regions are sites of intense star formation, lit up by the ultraviolet radiation from hot, young, massive stars. The arms also contain dust lanes, which are visible as dark streaks silhouetted against the bright starlight. These dust lanes are composed of interstellar dust grains that absorb and scatter light, particularly blue light.\n","*   **Central Bulge:** Compared to other spiral galaxies, IC 5322 has a relatively small and less-pronounced central bulge. The bulge is the central, spherical component of a spiral galaxy, primarily composed of older stars.  The smaller bulge size in IC 5322 is consistent with its Sc type classification.\n","*   **Disk:** The disk of the galaxy, where the spiral arms reside, is flattened and rotating. The disk contains most of the galaxy's gas, dust, and young stars.\n","*   **Halo (Inferred):** Like most spiral galaxies, IC 5322 is expected to have a dark matter halo surrounding it.  Dark matter does not interact with light and is only detectable through its gravitational effects on the visible matter (stars and gas). The dark matter halo provides the extra gravitational pull needed to keep the galaxy from flying apart due to its own rotation.\n","\n","**Spectral Properties and Star Formation:**\n","\n","*   **HII Regions:**  The presence of many bright HII regions is a hallmark of active star formation. Spectroscopic analysis of the light from these regions reveals the presence of emission lines from ionized elements such as hydrogen, oxygen, and nitrogen. The intensities of these lines can be used to estimate the abundance of these elements, the temperature and density of the gas, and the rate of star formation.\n","*   **Star Formation Rate (SFR):** IC 5322 is classified as a star-forming galaxy.  Detailed studies using ultraviolet (UV) and infrared (IR) observations are often used to quantify the star formation rate. UV light is emitted by young, massive stars, while infrared light is emitted by dust that has been heated by these stars.\n","*   **Metallicity:** Metallicity refers to the abundance of elements heavier than hydrogen and helium.  The metallicity of IC 5322 can be estimated from the emission lines in its spectra.  Generally, spiral galaxies show a metallicity gradient, with higher metallicities in the central regions and lower metallicities in the outer regions. This is because stars in the central regions have undergone more cycles of star formation and death, enriching the interstellar medium with heavy elements.\n","\n","**Interesting Facts and Research:**\n","\n","*   **Isolated Galaxy:** IC 5322 doesn't have any significant nearby galaxy companions, which makes it an interesting case study for understanding galaxy evolution in a relatively isolated environment. Its evolution is largely determined by its internal processes rather than by interactions with other galaxies.\n","*   **Studies of Star Formation:** IC 5322 has been the subject of various astronomical studies focusing on its star formation properties, including investigations of the relationship between the density of gas and the rate of star formation, and the distribution of star clusters in the spiral arms.\n","*   **Comparison to Other Galaxies:** IC 5322 provides a valuable point of comparison for understanding the diversity of spiral galaxies.  By comparing its properties with those of other spiral galaxies, such as those in the Virgo Cluster, astronomers can learn about the factors that influence galaxy evolution, such as environment, merger history, and the presence of a central black hole.\n","*   **Supernova Potential:** As a star-forming galaxy, IC 5322 has the potential to host supernova events. Supernovae are powerful explosions of massive stars at the end of their lives.  Monitoring IC 5322 for supernovae can provide valuable insights into the life cycle of massive stars and the chemical enrichment of the interstellar medium.\n","\n","**Observations and Future Research:**\n","\n","*   **Telescopes Used:** IC 5322 has been observed by a range of telescopes across the electromagnetic spectrum, including optical telescopes such as the Hubble Space Telescope and the Very Large Telescope (VLT), as well as radio telescopes.\n","*   **Ongoing Research:** Astronomers continue to study IC 5322 using advanced telescopes and techniques.  Future research may focus on:\n","    *   Mapping the distribution of molecular gas in the spiral arms to understand the fuel for star formation.\n","    *   Studying the stellar populations in the bulge and disk to learn about the galaxy's formation history.\n","    *   Searching for a supermassive black hole at the galaxy's center and investigating its role in the galaxy's evolution.\n","    *   Using integral field spectrographs to obtain detailed spectra across the entire galaxy and study the properties of the gas and stars in different regions.\n","\n","In summary, IC 5322 is a barred spiral galaxy (SBc) located approximately 75 million light-years away. It showcases loosely wound spiral arms, active star formation, a relatively small central bulge, and a prominent stellar bar. Its relative isolation makes it a valuable subject for understanding galaxy evolution. Ongoing research continues to unravel its properties and contribute to our understanding of the universe.\n","\n"]}],"source":["import google.generativeai as genai\n","# Configure Gemini API\n","genai.configure(api_key=\"AIzaSyCg-q8dwYE-1B955fSsvVkZfNmV5jLtgz8\")\n","\n","\n","def learn_more():\n","    galaxy_name =\"IC-5322\"\n","\n","    # Use Gemini to get detailed analysis\n","    model = genai.GenerativeModel('gemini-2.0-flash')\n","    prompt = f\"Give me a detailed scientific explanation of the galaxy '{galaxy_name}', including structure, type, and interesting facts.\"\n","\n","    try:\n","        response = model.generate_content(prompt)\n","        analysis = response.text\n","    except Exception as e:\n","        analysis = f\"Error fetching details: {e}\"\n","\n","    print(analysis)\n","\n","learn_more()\n"]},{"cell_type":"code","execution_count":3,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":3341,"status":"ok","timestamp":1744631943899,"user":{"displayName":"Swaraj Pawar","userId":"00736123951744289084"},"user_tz":-330},"id":"_ZqRyhItc2Kk","outputId":"97bf75c8-e61e-4d18-bdfc-aebd4b472fbf"},"outputs":[{"name":"stdout","output_type":"stream","text":["Collecting pyngrok\n","  Downloading pyngrok-7.2.3-py3-none-any.whl.metadata (8.7 kB)\n","Requirement already satisfied: PyYAML\u003e=5.1 in /usr/local/lib/python3.11/dist-packages (from pyngrok) (6.0.2)\n","Downloading pyngrok-7.2.3-py3-none-any.whl (23 kB)\n","Installing collected packages: pyngrok\n","Successfully installed pyngrok-7.2.3\n"]}],"source":["!pip install pyngrok"]}],"metadata":{"colab":{"authorship_tag":"ABX9TyOAGONFBNMZ/A51pHfG595d","name":"","version":""},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}